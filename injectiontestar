-- ✅ ESP Players (melhorado) + ESP Bases (com contador de tempo)
-- ✅ Interface Azul + Botão Discord
-- ✅ Autorizado para testes

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- Configurações
local ESPAtivo, BasesESPAtivo = false, false
local DrawingsPlayers = {}
local DrawingsBases = {}

-- Ajuste: Nome da pasta das bases no mapa
local Bases = workspace:WaitForChild("Bases") -- 🔹 troque se no seu jogo for outro nome!

-- 🎨 Interface
local function CriarInterface()
    local gui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
    gui.ResetOnSpawn = false
    gui.Name = "PainelHack"

    local frame = Instance.new("Frame", gui)
    frame.Size = UDim2.new(0, 220, 0, 200)
    frame.Position = UDim2.new(0, 10, 0, 10)
    frame.BackgroundColor3 = Color3.fromRGB(20, 20, 50)
    frame.BorderSizePixel = 0

    local titulo = Instance.new("TextLabel", frame)
    titulo.Size = UDim2.new(1, 0, 0, 30)
    titulo.BackgroundColor3 = Color3.fromRGB(0, 85, 255)
    titulo.Text = "INJECTION - ROBLOX FREE"
    titulo.TextColor3 = Color3.fromRGB(255, 255, 255)
    titulo.TextSize = 18
    titulo.Font = Enum.Font.SourceSansBold

    local function CriarBotao(texto, posY, aoClicar)
        local botao = Instance.new("TextButton", frame)
        botao.Size = UDim2.new(1, -20, 0, 30)
        botao.Position = UDim2.new(0, 10, 0, posY)
        botao.BackgroundColor3 = Color3.fromRGB(0, 40, 100)
        botao.TextColor3 = Color3.new(1, 1, 1)
        botao.Font = Enum.Font.SourceSans
        botao.TextSize = 16
        botao.Text = texto
        botao.MouseButton1Click:Connect(function()
            aoClicar(botao)
        end)
        return botao
    end

    CriarBotao("ESP Players: OFF", 40, function(btn)
        ESPAtivo = not ESPAtivo
        btn.Text = ESPAtivo and "ESP Players: ON" or "ESP Players: OFF"
    end)

    CriarBotao("ESP Bases: OFF", 80, function(btn)
        BasesESPAtivo = not BasesESPAtivo
        btn.Text = BasesESPAtivo and "ESP Bases: ON" or "ESP Bases: OFF"
    end)

    CriarBotao("🌐 Discord", 130, function()
        setclipboard("https://discord.gg/scriptroblox")
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "Discord",
            Text = "Link copiado para área de transferência!",
            Duration = 3
        })
    end)
end

-- 🧍 ESP Player melhorado (Caixa + Nome + Distância)
local function CriarCaixaPlayer(plr)
    local box = Drawing.new("Square")
    box.Visible = false
    box.Thickness = 2
    box.Color = Color3.fromRGB(0, 255, 255)
    box.Filled = false

    local texto = Drawing.new("Text")
    texto.Visible = false
    texto.Size = 16
    texto.Color = Color3.fromRGB(255, 255, 255)
    texto.Center = true
    texto.Outline = true

    DrawingsPlayers[plr] = {Box = box, Texto = texto}
end

for _, p in ipairs(Players:GetPlayers()) do
    if p ~= LocalPlayer then
        CriarCaixaPlayer(p)
    end
end

Players.PlayerAdded:Connect(function(p)
    if p ~= LocalPlayer then
        CriarCaixaPlayer(p)
    end
end)

Players.PlayerRemoving:Connect(function(p)
    if DrawingsPlayers[p] then
        DrawingsPlayers[p].Box:Remove()
        DrawingsPlayers[p].Texto:Remove()
        DrawingsPlayers[p] = nil
    end
end)

-- 🏠 ESP Bases (com tempo)
local function CriarESPBase(base)
    local texto = Drawing.new("Text")
    texto.Visible = false
    texto.Size = 16
    texto.Color = Color3.fromRGB(0, 255, 0)
    texto.Center = true
    texto.Outline = true
    DrawingsBases[base] = texto
end

for _, base in ipairs(Bases:GetChildren()) do
    CriarESPBase(base)
end

Bases.ChildAdded:Connect(function(base)
    CriarESPBase(base)
end)

Bases.ChildRemoved:Connect(function(base)
    if DrawingsBases[base] then
        DrawingsBases[base]:Remove()
        DrawingsBases[base] = nil
    end
end)

-- 🔁 Atualização do ESP
RunService.RenderStepped:Connect(function()
    -- ESP Players
    for plr, dados in pairs(DrawingsPlayers) do
        local box, texto = dados.Box, dados.Texto
        if ESPAtivo and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") and plr.Character:FindFirstChild("Head") then
            local hrp = plr.Character.HumanoidRootPart
            local head = plr.Character.Head
            local top = Camera:WorldToViewportPoint(head.Position + Vector3.new(0, 0.5, 0))
            local bottom = Camera:WorldToViewportPoint(hrp.Position - Vector3.new(0, 2.5, 0))

            if bottom.Z > 0 then
                local height = math.abs(top.Y - bottom.Y)
                local width = height / 2
                box.Size = Vector2.new(width, height)
                box.Position = Vector2.new(top.X - width / 2, top.Y)
                box.Visible = true

                -- Distância
                local dist = (LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")) and math.floor((hrp.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude) or 0
                texto.Text = plr.Name .. " [" .. dist .. "m]"
                texto.Position = Vector2.new(top.X, top.Y - 15)
                texto.Visible = true
            else
                box.Visible = false
                texto.Visible = false
            end
        else
            box.Visible = false
            texto.Visible = false
        end
    end

    -- ESP Bases
    for base, texto in pairs(DrawingsBases) do
        if BasesESPAtivo and base and base:IsA("BasePart") and base:FindFirstChild("Tempo") then
            local pos, onScreen = Camera:WorldToViewportPoint(base.Position + Vector3.new(0, 5, 0))
            if onScreen then
                texto.Position = Vector2.new(pos.X, pos.Y)
                texto.Text = "Base (" .. tostring(base.Tempo.Value) .. "s)"
                texto.Visible = true
            else
                texto.Visible = false
            end
        else
            texto.Visible = false
        end
    end
end)

-- 🟦 Inicializa
CriarInterface()

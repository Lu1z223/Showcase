-- ✅ ESP + Speed + Jump + Salvar/Voltar Posição
-- ✅ Interface Azul + Botão de Fechar/Abrir no celular
-- ✅ Speed suave, sem puxar para trás
-- ✅ Voltar posição rápido e girando

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

local ESPAtivo, SpeedAtivo, JumpAtivo = false, false, false
local VelocidadeDesejada = 100
local JumpPowerDesejado = 100
local posicaoSalva = nil
local Drawings = {}
local FrameMenu

local speedState = { speedConn = nil, diedConn = nil }

-- ======== ESP ========
local function CriarESP(player)
    if player == LocalPlayer then return end
    local highlight = Instance.new("Highlight")
    highlight.Adornee = player.Character
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
    highlight.FillColor = Color3.fromRGB(0, 255, 0)
    highlight.OutlineColor = Color3.fromRGB(0, 0, 0)
    highlight.Parent = player.Character
    Drawings[player] = highlight
end

local function RemoverESP(player)
    if Drawings[player] then
        Drawings[player]:Destroy()
        Drawings[player] = nil
    end
end

local function AtivarESP()
    for _, p in ipairs(Players:GetPlayers()) do
        if p.Character then CriarESP(p) end
    end
    Players.PlayerAdded:Connect(function(p) p.CharacterAdded:Connect(function() CriarESP(p) end) end)
    Players.PlayerRemoving:Connect(function(p) RemoverESP(p) end)
end

local function DesativarESP()
    for p, h in pairs(Drawings) do
        h:Destroy()
    end
    Drawings = {}
end

-- ======== SPEED ========
local function StopEnforceSpeed()
    if speedState.speedConn then speedState.speedConn:Disconnect() end
    if speedState.diedConn then speedState.diedConn:Disconnect() end
    speedState.speedConn, speedState.diedConn = nil, nil
end

local function StartEnforceSpeed(humanoid)
    StopEnforceSpeed()
    local char = LocalPlayer.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    speedState.speedConn = RunService.Heartbeat:Connect(function()
        if SpeedAtivo and humanoid and humanoid.Parent and hrp and hrp.Parent then
            local moveDir = humanoid.MoveDirection
            if moveDir.Magnitude > 0.01 then
                hrp.AssemblyLinearVelocity = Vector3.new(
                    moveDir.X * VelocidadeDesejada,
                    hrp.AssemblyLinearVelocity.Y,
                    moveDir.Z * VelocidadeDesejada
                )
            else
                hrp.AssemblyLinearVelocity = Vector3.new(0, hrp.AssemblyLinearVelocity.Y, 0)
            end
        end
    end)

    speedState.diedConn = humanoid.Died:Connect(function() StopEnforceSpeed() end)
end

-- ======== VOLTAR POSIÇÃO ========
local function VoarParaPosicao(hrp, destino)
    local humanoid = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
    if not humanoid then return end

    local conexao
    conexao = RunService.Heartbeat:Connect(function()
        if not hrp or not hrp.Parent then 
            conexao:Disconnect()
            return 
        end

        local diff = destino - hrp.Position
        local dist = diff.Magnitude

        if dist < 1 then
            conexao:Disconnect()
        else
            local lookAt = CFrame.lookAt(hrp.Position, destino)
            hrp.CFrame = lookAt
            humanoid:MoveTo(hrp.Position + diff.Unit * 8) -- Passos de 8 studs
        end
    end)
end

-- ======== INTERFACE ========
local function CriarMenu()
    local screenGui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))

    local botaoAbrir = Instance.new("TextButton", screenGui)
    botaoAbrir.Size = UDim2.new(0, 100, 0, 40)
    botaoAbrir.Position = UDim2.new(0, 20, 1, -60)
    botaoAbrir.Text = "Abrir Menu"
    botaoAbrir.BackgroundColor3 = Color3.fromRGB(0, 85, 255)
    botaoAbrir.TextColor3 = Color3.new(1, 1, 1)
    botaoAbrir.Visible = true

    FrameMenu = Instance.new("Frame", screenGui)
    FrameMenu.Size = UDim2.new(0, 250, 0, 300)
    FrameMenu.Position = UDim2.new(0, 20, 0, 20)
    FrameMenu.BackgroundColor3 = Color3.fromRGB(0, 60, 180)
    FrameMenu.Visible = false

    local titulo = Instance.new("TextLabel", FrameMenu)
    titulo.Size = UDim2.new(1, -40, 0, 40)
    titulo.Position = UDim2.new(0, 10, 0, 0)
    titulo.Text = "Injection - Roblox"
    titulo.TextColor3 = Color3.new(1, 1, 1)
    titulo.BackgroundTransparency = 1
    titulo.Font = Enum.Font.SourceSansBold
    titulo.TextSize = 20

    local botaoFechar = Instance.new("TextButton", FrameMenu)
    botaoFechar.Size = UDim2.new(0, 40, 0, 40)
    botaoFechar.Position = UDim2.new(1, -40, 0, 0)
    botaoFechar.Text = "X"
    botaoFechar.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    botaoFechar.TextColor3 = Color3.new(1, 1, 1)

    local function CriarBotao(texto, ordem, callback)
        local btn = Instance.new("TextButton", FrameMenu)
        btn.Size = UDim2.new(1, -20, 0, 40)
        btn.Position = UDim2.new(0, 10, 0, 50 + (ordem - 1) * 50)
        btn.Text = texto
        btn.BackgroundColor3 = Color3.fromRGB(0, 100, 255)
        btn.TextColor3 = Color3.new(1, 1, 1)
        btn.MouseButton1Click:Connect(callback)
        return btn
    end

    local btnESP = CriarBotao("ESP: OFF", 1, function()
        ESPAtivo = not ESPAtivo
        btnESP.Text = "ESP: " .. (ESPAtivo and "ON" or "OFF")
        if ESPAtivo then AtivarESP() else DesativarESP() end
    end)

    local btnSpeed = CriarBotao("Speed: OFF", 2, function()
        SpeedAtivo = not SpeedAtivo
        btnSpeed.Text = "Speed: " .. (SpeedAtivo and "ON" or "OFF")
        if SpeedAtivo then
            local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
            if humanoid then StartEnforceSpeed(humanoid) end
        else
            StopEnforceSpeed()
        end
    end)

    local btnJump = CriarBotao("Jump: OFF", 3, function()
        JumpAtivo = not JumpAtivo
        btnJump.Text = "Jump: " .. (JumpAtivo and "ON" or "OFF")
        if JumpAtivo then
            local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
            if humanoid then humanoid.UseJumpPower = true humanoid.JumpPower = JumpPowerDesejado end
        else
            local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
            if humanoid then humanoid.UseJumpPower = false end
        end
    end)

    CriarBotao("Salvar Posição", 4, function()
        local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if hrp then posicaoSalva = hrp.Position end
    end)

    CriarBotao("Voltar Posição", 5, function()
        local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if hrp and posicaoSalva then
            VoarParaPosicao(hrp, posicaoSalva)
        end
    end)

    botaoAbrir.MouseButton1Click:Connect(function()
        FrameMenu.Visible = true
        botaoAbrir.Visible = false
    end)

    botaoFechar.MouseButton1Click:Connect(function()
        FrameMenu.Visible = false
        botaoAbrir.Visible = true
    end)
end

CriarMenu()

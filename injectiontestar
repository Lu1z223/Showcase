-- ✅ ESP + Speed + Jump corrigidos para "Roube Um Brainrot"
-- ✅ Interface Azul + Botão de Fechar + Botão de Abrir no celular
-- ✅ Fix: enforcement robusto do Speed (AssemblyLinearVelocity)
-- ✅ Voltar Posição suave (2 studs por frame)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

local ESPAtivo, SpeedAtivo, JumpAtivo = false, false, false
local posicaoSalva = nil

local VelocidadeDesejada = 28 -- velocidade segura
local JumpPowerDesejado = 100

local speedState = {
    speedConn = nil,
    diedConn = nil
}

-- === ESP Simples ===
local function ToggleESP(estado)
    ESPAtivo = estado
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer then
            local char = plr.Character
            if char and char:FindFirstChild("Head") then
                if estado then
                    if not char.Head:FindFirstChild("BillboardGui") then
                        local bill = Instance.new("BillboardGui", char.Head)
                        bill.Size = UDim2.new(0, 200, 0, 50)
                        bill.AlwaysOnTop = true
                        bill.Adornee = char.Head
                        local label = Instance.new("TextLabel", bill)
                        label.Size = UDim2.new(1, 0, 1, 0)
                        label.BackgroundTransparency = 1
                        label.TextColor3 = Color3.new(1, 0, 0)
                        label.Text = plr.Name
                    end
                else
                    if char.Head:FindFirstChild("BillboardGui") then
                        char.Head.BillboardGui:Destroy()
                    end
                end
            end
        end
    end
end

-- === Função para parar o Speed ===
local function StopEnforceSpeed()
    if speedState.speedConn then
        speedState.speedConn:Disconnect()
        speedState.speedConn = nil
    end
    if speedState.diedConn then
        speedState.diedConn:Disconnect()
        speedState.diedConn = nil
    end
end

-- === Função para aplicar Speed de forma segura ===
local function StartEnforceSpeed(humanoid)
    StopEnforceSpeed()
    local char = LocalPlayer.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    speedState.speedConn = RunService.Heartbeat:Connect(function()
        if SpeedAtivo and humanoid and humanoid.Parent and hrp and hrp.Parent then
            local moveDir = humanoid.MoveDirection
            if moveDir.Magnitude > 0 then
                local vel = moveDir * VelocidadeDesejada
                hrp.AssemblyLinearVelocity = Vector3.new(vel.X, hrp.AssemblyLinearVelocity.Y, vel.Z)
            end
        end
    end)

    speedState.diedConn = humanoid.Died:Connect(function()
        StopEnforceSpeed()
    end)
end

-- === Função para Voltar Suavemente até posição salva ===
local function VoarParaPosicao(hrp, destino)
    local conexao
    conexao = RunService.Heartbeat:Connect(function()
        if not hrp or not hrp.Parent then
            conexao:Disconnect()
            return
        end
        local diff = destino - hrp.Position
        if diff.Magnitude < 2 then
            hrp.CFrame = CFrame.new(destino)
            hrp.AssemblyLinearVelocity = Vector3.zero
            conexao:Disconnect()
        else
            local step = diff.Unit * math.min(2, diff.Magnitude)
            hrp.CFrame = hrp.CFrame + step
        end
    end)
end

-- === Evento de Respawn ===
LocalPlayer.CharacterAdded:Connect(function(char)
    local humanoid = char:WaitForChild("Humanoid")
    StartEnforceSpeed(humanoid)
end)

-- === Interface ===
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
ScreenGui.ResetOnSpawn = false

local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 250, 0, 200)
Frame.Position = UDim2.new(0.1, 0, 0.1, 0)
Frame.BackgroundColor3 = Color3.fromRGB(0, 85, 255)

local function CriarBotao(texto, ordem, callback)
    local btn = Instance.new("TextButton", Frame)
    btn.Size = UDim2.new(1, -20, 0, 30)
    btn.Position = UDim2.new(0, 10, 0, 10 + (ordem - 1) * 40)
    btn.BackgroundColor3 = Color3.fromRGB(0, 0, 100)
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.Text = texto
    btn.MouseButton1Click:Connect(callback)
end

CriarBotao("ESP", 1, function()
    ESPAtivo = not ESPAtivo
    ToggleESP(ESPAtivo)
end)

CriarBotao("Speed", 2, function()
    SpeedAtivo = not SpeedAtivo
    local char = LocalPlayer.Character
    local humanoid = char and char:FindFirstChild("Humanoid")
    if humanoid then
        if SpeedAtivo then
            StartEnforceSpeed(humanoid)
        else
            StopEnforceSpeed()
        end
    end
end)

CriarBotao("Jump", 3, function()
    JumpAtivo = not JumpAtivo
    local char = LocalPlayer.Character
    local humanoid = char and char:FindFirstChild("Humanoid")
    if humanoid then
        humanoid.UseJumpPower = true
        humanoid.JumpPower = JumpAtivo and JumpPowerDesejado or 50
    end
end)

CriarBotao("Salvar Posição", 4, function()
    local char = LocalPlayer.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if hrp then
        posicaoSalva = hrp.Position
    end
end)

CriarBotao("Voltar Posição", 5, function()
    local char = LocalPlayer.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    if hrp and posicaoSalva then
        VoarParaPosicao(hrp, posicaoSalva)
    end
end)
